name: Conda Build Python 🐍 package, Test 📝, and Publish 🎉.

on:
  # push:
    # branches: [ main ]
  # pull_request:
    # branches: [ main ]
  workflow_dispatch:

jobs:
  build_wheels:
    name: Build conda package for ${{ matrix.os }}
    runs-on: ${{ matrix.os }}

    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest]
        include:
          - os: ubuntu-latest
          - os: macos-latest

    steps:
    - uses: actions/checkout@v2
    - name: Get history and tags for SCM versioning
      run: |
        git fetch --prune --unshallow
        git fetch --depth=1 origin +refs/tags/*:refs/tags/*

    - name: publish-to-conda
      uses: maxibor/conda-package-publish-action@v1.1
      with:
        subDir: 'recipe'
        AnacondaToken: ${{ secrets.ANACONDA_UPLOAD_TOKEN }}

    # - name: Upload Build Artifact
    #   uses: actions/upload-artifact@v2.2.4
    #   with:
    #     name: nupyprop-gh-conda-artifact
    #     path: /*.whl
